<%- layout('layouts/main')  %> 

<!-- Modal de mapas -->
<div class="modal fade" id="mapaModal" tabindex="-1" aria-labelledby="mapaModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-fullscreen">
      <div class="modal-content">
          <div class="modal-header">
              <h5 class="modal-title" id="mapaModalLabel">Mapa</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar">
              </button>
          </div>
          <div class="modal-body text-center">
              <img src="" class="img-fluid" alt="Sin imagen mapa" />
          </div>
      </div>
  </div>
</div>

<!-- Titulo vista-->
<h3 class="display-5 text-center my-4 text-uppercase">Parques</h3>

<!-- Filtros -->
<form action="#" class="row g-4 mb-3 justify-content-center">
  <div class="col-5">
    <input class="form-control" type="text" placeholder="Buscar...">
  </div>
  <div class="col-auto">
    <div class="form-check">
      <input checked class="form-check-input" type="checkbox" id="cboxNacionales">
      <label class="form-check-label" for="flexCheckDefault">Parques nacionales</label>
    </div>
    <div class="form-check">
      <input checked class="form-check-input" type="checkbox" id="cboxIndependientes">
      <label class="form-check-label">Parques independientes</label>
    </div>
  </div>
  <div class="col-auto">
    <button class="btn btn-outline-primary">Filtrar</button>
  </div>
  <div class="col-auto">
    <select class="form-select">
      <option selected>Ordenar por...</option>
      <option value="1">Cercanía</option>
      <option value="2">Precio entrada</option>
    </select>
  </div>
</form>


<!-- Tarjetas -->
<div class="container mt-5">
  <% if (listado.length > 0) {
    for (let item of listado) { %> 
      <div class="row">
        <div class="col-12">
          <article class="card mb-3 bg-secondary shadow-sm">
            <div class="row g-0 ">
              <div class="col-md-4">
                <img src="images/parques/<%= item.cod_parque%>/main.jpg"  class="rounded" alt="Sin imagen: <%= item.nombre %>" style="width: 100%; height: auto; vertical-align:top;">
              </div>
              <div class="col-md-8">
                <div class="card-body ms-3">
                  <h4 class="card-title"><%= item.nombre %></h4>
                  <p class="card-text"><%= item.descripcion %> </p>
                    <a  class="card-link" data-bs-toggle="collapse" href="#collapse<%= item.cod_parque%>" role="button" aria-expanded="false" aria-controls="collapseExample">
                      Ver más...
                    </a>
                    
                    <div class="collapse" id="collapse<%= item.cod_parque%>">
                      <div class="card card-body">
                        Some placeholder content for the collapse component.
                        This panel is hidden by default but revealed when the
                        user activates the relevant trigger.
                      </div>
                      
                  </div>
                  <div style="text-align: right;">
                    
                    <button type="button" class="btn btn-primary text-light" data-bs-toggle="modal" data-bs-target="#mapaModal" data-bs-whatever="<%=item.cod_parque%>">Ver mapa</button>
                    <a href="#" class="btn btn-primary text-light">Descargar mapa</a>
                    <a href="#" class="btn btn-primary text-light">Hacer reserva</a>
                  </div>
                </div>
              </div>
            </div>
          </article>
        </div>
      </div>
    <% }
  } else { %>
    <div class="row">
      <h1 class="display-4 text-center">No hay parques en este momento</h1>
    </div>
  <% } %>

</div>




<script>
  var mapaModal = document.getElementById('mapaModal');
  mapaModal.addEventListener('show.bs.modal', function (event) {
    // Boton que gatilla el modal
    var button = event.relatedTarget;
    // Extraer info de atributos de data-bs-*
    var recipient = button.getAttribute('data-bs-whatever');
    // Actualizar el contenido del modal
    var modalBodyImg = mapaModal.querySelector('.modal-body img');
    console.log(recipient);
    modalBodyImg.src = `images/parques/${recipient}/map.jpg`;
  });

  var options = {
    // Propiedades de ubicacion
    enableHighAccuracy: true,
    timeout: 5000,
    maximumAge: 0
  };

  function success(pos) {
    var crd = pos.coords;
    // Imprimir por consola la posición
    console.log('Posición actual es:');
    console.log('Latitud : ' + crd.latitude);
    console.log('Longitud: ' + crd.longitude);
    console.log('Precisión ±' + crd.accuracy + ' metros.');
  };

  function error(err) {
    console.warn('ERROR(' + err.code + '): ' + err.message);
  };

  navigator.geolocation.getCurrentPosition(success, error, options);
</script>